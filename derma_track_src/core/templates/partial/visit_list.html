{% load static %}

<script src="{% static 'js/triggerModal.js' %}"></script>

<div class="container-fluid my-3 p-3 bg-light rounded shadow-sm">
    <table class="table align-middle mb-0 bg-white" id="visit-table">
        <thead class="bg-light">
            <tr>
                <th>Date</th>
                <th>Time</th>
                <th>Doctor Name</th>
                <th>Patient Name</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for visit in visits %}
            <tr>
                <td>{{ visit.date|date:"D d M Y"  }}</td>
                <td>{{ visit.date|time:"H:i" }}</td>
                <td>{{ visit.doctor.full_name }}</td>
                <td class="patient-name">{{ visit.patient.full_name }}</td>
                <td> 
                    {% if visit.status == "scheduled" %}
                    <span class="badge text-bg-warning">
                    {% elif visit.status == "started" %}
                    <span class="badge text-bg-info">
                    {% elif visit.status == "canceled" %}
                    <span class="badge text-bg-danger">
                    {% else %}
                    <span class="badge text-bg-success">
                    {% endif %}
                    {{ visit.get_status_display  }}
                    </span>
                </td>
                <td>       
                    <div style="display: flex; align-items: center; gap: 10px;">
                        {% if visit.status == "canceled" or visit.status == "finished" or visit.status == "started" %}
                        <form class="button-form" hx-post="/core/visit_view" hx-target="#pop-up" hx-swap="innerHTML" method='POST'>
                            {% csrf_token %}
                            <input type="hidden" name="id" class="form-control" value="{{visit.pk}}" required=""> 
                            <button type="submit" class="btn btn-success" data-mdb-ripple-color="dark"> View </button>
                        </form>
                        {% endif %}

                        <form class="button-form" hx-post="/core/visit_status" hx-target="#dynamic-body" hx-swap="innerHTML" method='POST'>
                            {% csrf_token %}
                            <input type="hidden" name="id" class="form-control" value="{{visit.pk}}" required=""> 
                            {% if visit.status == "scheduled" %}
                                <button type="submit" class="btn btn-success" value="Started" name="status" data-mdb-ripple-color="dark"> Start </button>
                                <button type="submit" class="btn btn-danger" value="Canceled" name="status" data-mdb-ripple-color="dark"> Cancel </button>
                            {% elif visit.status == "started" %}
                                <button type="submit" class="btn btn-danger" value="Finished" name="status" data-mdb-ripple-color="dark"> Finish </button>
                            {% endif %}
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-3">
            {% if visits.has_previous %}
                <li class="page-item">
                    <a class="page-link" hx-get="?page=1" hx-target="#dynamic-body" hx-swap="innerHTML">&laquo; First</a>
                </li>
                <li class="page-item">
                    <a class="page-link" hx-get="?page={{ visits.previous_page_number }}" hx-target="#dynamic-body" hx-swap="innerHTML">Previous</a>
                </li>
            {% endif %}

            <li class="page-item active">
                <span class="page-link">
                    Page {{ visits.number }} of {{ visits.paginator.num_pages }}
                </span>
            </li>

            {% if visits.has_next %}
                <li class="page-item">
                    <a class="page-link" hx-get="?page={{ visits.next_page_number }}" hx-target="#dynamic-body" hx-swap="innerHTML">Next</a>
                </li>
                <li class="page-item">
                    <a class="page-link" hx-get="?page={{ visits.paginator.num_pages }}" hx-target="#dynamic-body" hx-swap="innerHTML">Last &raquo;</a>
                </li>
            {% endif %}
        </ul>
    </nav>
</div>

<div id="pop-up"></div>
